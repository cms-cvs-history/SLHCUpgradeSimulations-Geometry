process Reco = 
{
    untracked PSet maxEvents = {untracked int32 input = 200}
    # this example configuration offers some minimum 
    # annotation, to help users get through; please
    # don't hesitate to read through the comments
    
    
    # use MessageLogger to redirect/suppress multiple
    # service messages coming from the system
    #
    # in this config below, we use the replace option to make
    # the logger let out messages of severity ERROR (INFO level
    # will be suppressed), and we want to limit the number to 10
    #
    include "Configuration/ReleaseValidation/data/Services.cff"
    include "Configuration/StandardSequences/data/FakeConditions.cff" 
    #include "FWCore/MessageService/data/MessageLogger.cfi"
    #replace MessageLogger.destinations = {"detailedInfo.txt"}
       
     
    # in you wish to quiet the logger even more and leave in 
    # only info from the Framework, use config example below :
    #
    service = MessageLogger
    {
       untracked vstring destinations = {"detailedInfo_spa-10_100kev.txt"} 
       untracked vstring categories = { "TkNavigation" } 
       untracked vstring debugModules   = {"ckfTrackCandidates" }
#       untracked PSet detailedInfo.txt =
#       {    service = SimpleMemoryCheck{ }
 
#          untracked PSet default = { untracked int32 limit = 0 }  # kill all messages in the log
#          untracked PSet TkNavigation = { untracked int32 limit = 1000000 } # but FwkJob category - those unlimitted
#       } 
  untracked PSet detailedInfo.txt = { untracked string threshold = "DEBUG"
                                       untracked PSet INFO            = { untracked int32 limit = 0 }
                                       untracked PSet DEBUG           = { untracked int32 limit = 0 }
			               untracked PSet TkNavigation = { untracked int32 limit = 10000000}
  } 
 
   }
    
    service = Timing { }   
    untracked PSet options = {
      include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
      untracked bool wantSummary = true
}
    service = SimpleMemoryCheck{ }
 

    # an example of "source", flat-pt single muon gun in this case
    # 
        
    source = FlatRandomPtGunSource
    {
	untracked PSet PGunParameters =
	{
	    # you can request more than 1 particle
	    # since PartID is a vector, you can place in as many 
	    # PDG id's as you wish, comma seaparated
	    #
	    untracked vint32 PartID = { 13 }
	    untracked double MinEta = -2.5
	    untracked double MaxEta = 2.5
#	    untracked double MinEta = 1.2
#	    untracked double MaxEta = 1.5
	    untracked double MinPhi = -3.14159265358979323846 # in radians
	    untracked double MaxPhi =  3.14159265358979323846
#	    untracked double MinPhi = 0. # in radians
#	    untracked double MaxPhi =  0.1
	    untracked double MinPt  = 50.
	    untracked double MaxPt  = 50.
	}
	untracked bool AddAntiParticle = true # back-to-back particles
	untracked int32 Verbosity = 3 # set to 1 (or greater)  for printouts
   }
   
    # this config frament brings you the generator information
    
    include "Configuration/StandardSequences/data/Generator.cff"
    
    # this config frament brings you 3 steps of the detector simulation:
    # -- vertex smearing (IR modeling)
    # -- G4-based hit level detector simulation
    # -- digitization (electronics readout modeling)
    # it returns 2 sequences : 
    # -- psim (vtx smearing + G4 sim)
    # -- pdigi (digitization in all subsystems, i.e. tracker=pix+sistrips,
    #           cal=ecal+ecal-0-suppression+hcal), muon=csc+dt+rpc)
    #
    include "Configuration/StandardSequences/data/Simulation.cff"
    # replace the standard geometry include
    include "SLHCUpgradeSimulations/Geometry/data/strawmana/replace_cmsIdealGeometryXML.cfi"
    
    # please note the IMPORTANT: 
    # in order to operate Digis, one needs to include Mixing module 
    # (pileup modeling), at least in the 0-pileup mode
    #
    # There're 3 possible configurations of the Mixing module :
    # no-pileup, low luminosity pileup, and high luminosity pileup
    #
    # they come, respectively, through the 3 config fragments below
    #
    # *each* config returns label "mix"; thus you canNOT have them
    # all together in the same configuration, but only one !!!
    #
    
    
    include "Configuration/StandardSequences/data/MixingNoPileUp.cff" 
    #include "Configuration/StandardSequences/data/MixingLowLumiPileUp.cff" 
    #include "Configuration/StandardSequences/data/MixingHighLumiPileUp.cff" 
    
#    include "Configuration/StandardSequences/data/L1Emulator.cff" 

    include "Configuration/StandardSequences/data/DigiToRaw.cff"

#    include "Configuration/StandardSequences/data/VtxSmearedBetafuncEarlyCollision.cff"
    include "Configuration/StandardSequences/data/VtxSmearedGauss.cff"
#    include "Configuration/StandardSequences/data/VtxSmearedNoSmear.cff"
    
    include "Configuration/StandardSequences/data/Reconstruction.cff"
    
# Full Reco
   include "RecoLocalTracker/Configuration/data/RecoLocalTracker.cff"
   include "RecoTracker/Configuration/data/RecoTracker.cff"
   include "TrackingTools/Configuration/data/TrackingTools.cff"
   
     #replace ckfBaseTrajectoryFilter.filterPset.maxLostHits         = 3
     #replace ckfBaseTrajectoryFilter.filterPset.maxConsecLostHits   = 3
     #replace ckfBaseTrajectoryFilter.filterPset.minimumNumberOfHits = 5
   
# Stuff needed to produce efficiency plots

   include "SimGeneral/TrackingAnalysis/data/trackingParticles.cfi"
# Uncomment both for FastSim
#   replace trackingParticles.simHitLabel = "famosSimHits"
#   replace trackingParticles.TrackerHitLabels = { "TrackerHits" }
   include "SimTracker/TrackAssociation/data/TrackAssociatorByChi2.cfi"

# Uncomment only if digis are available
   include "SimTracker/TrackAssociation/data/TrackAssociatorByHits.cfi"
#  Uncomment for FastSim
#   replace TrackAssociatorByHitsESProducer.ROUList = { "TrackerHits" }

    # Filters
    //include "Validation/RecoTrack/data/cuts.cff"
    // not sure we need the change in SLHC_1_8_4 PhysicsTools/RecoAlgos
    // for the full simulation - but use it anyway
    include "Validation/RecoTrack/data/cutsCKF.cfi"
    include "Validation/RecoTrack/data/cutsRS.cfi"
    include "SLHCUpgradeSimulations/Geometry/data/cutsTPEffic.cfi"
    include "SLHCUpgradeSimulations/Geometry/data/cutsTPFake.cfi"

    # Track Validator    
    include "Validation/RecoTrack/data/MultiTrackValidator.cff"
    #replace multiTrackValidator.associators = {"TrackAssociatorByChi2"}
    replace multiTrackValidator.label = {cutsCKF}
    replace multiTrackValidator.out = "TrackVal_spa-10_100kev.root"
    replace multiTrackValidator.maxpT = 150
    replace multiTrackValidator.nintpT = 300

    
    module demo = DemoAnalyzer { 
          untracked uint32 minTracks = 1
	  untracked string HistOutFile = "analysis_spa-10_100kev.root"
    }

#  SiPixelDigitizer 
   replace siPixelDigis.NumPixelBarrel = 8
   replace siPixelDigis.AddPixelInefficiency = -1

# siPixelCluster (solve the calibration crash)
   replace siPixelClusters.MissCalibrate = false
    
# siPixelRecHits (studies to solve the invalid hit problem on strixels) 
include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEESProducers.cff" 
#   replace siPixelRecHits.CPE = "Initial" 
#   replace siPixelRecHits.CPE = "Generic" 

# SiStripDigitizer
    replace siStripDigis.Noise = true  # NOTE : turning Noise ON/OFF will make a big change

 				      
     include "CalibTracker/Configuration/data/SiPixel_FakeGain.cff"
     include "CalibTracker/Configuration/data/SiStrip_FakeGain.cff"
     include "CalibTracker/Configuration/data/SiStrip_FakeNoise.cff"
     include "CalibTracker/Configuration/data/SiStrip_FakePedestals.cff"
     include "CalibTracker/Configuration/data/SiStrip_FakeLorentzAngle.cff"
     include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPE.cfi"
 
     include "SimTracker/TrackAssociation/data/TrackAssociatorByHits.cfi"
     include "Validation/RecoTrack/data/SiStripTrackingRecHitsValid.cfi"
     include "Validation/RecoTrack/data/SiPixelTrackingRecHitsValid.cfi"
     
     include "Configuration/StandardSequences/data/SimulationRandomNumberGeneratorSeeds.cff"


   include "Validation/TrackerRecHits/data/SiStripRecHitsValid.cfi"
   

    path p0 = {pgen} # generator
    path p1 = {psim} # simulation
#    path p2 = {pdigi} # digitization
    path p2 = {mix, siPixelDigis & siStripDigis} # digitization
    path p3 = {L1Emulator}
#    path p4 = {DigiToRaw}
    path p4 = {siPixelRawData,SiStripDigiToRaw,rawDataCollector}
#    path p5 = {reconstruction} # reconstruction
   path p5 = {
  # Full Reco
  trackerlocalreco,
  ckftracks
#globalMixedSeeds,
#globalPixelSeeds, 
#ckfTrackCandidates,ctfWithMaterialTracks
}
  # Efficiency Plots
  path p6 = {  
  trackingParticles,
#  trackingtruth,
	 cutsCKF,
         cutsTPEffic, 
         cutsTPFake,
  multiTrackValidator
  #pixRecHitsValid,PixelTrackingRecHitsValid
       } 
   path p7 = {demo}
   path p8 = {trajectoryAnalyzer}
   path p9 = {trackingParticles,test}
   path p10 = {stripRecHitsValid}
   
    
    # Event output
    include "Configuration/EventContent/data/EventContent.cff"
    module FEVT = PoolOutputModule 
    { 
     	using FEVTSIMEventContent
	untracked string fileName = "/uscms_data/d1/cheung/slhc/newPhysVal-DiMuon-Pt50_spa-8_test.root"
    }
         module out = AsciiOutputModule {}

    endpath outpath = {FEVT}
    
    schedule = {p0,p1,p2,p5,p6,outpath}
    
   
}		
